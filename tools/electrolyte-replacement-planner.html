<!doctype html>
<html lang="en" data-mode="pro" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author-status" content="NAVLE-candidate-unlicensed" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <link rel="icon" type="image/svg+xml" href="/assets/img/vet-favicon.svg" />
    <title>Electrolyte Replacement Planner | VetLudics Tools</title>
    <meta
      name="description"
      content="Electrolyte replacement planning tool for potassium correction estimates in fluid therapy workflows."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Electrolyte Replacement Planner | VetLudics Tools"
    />
    <meta
      property="og:description"
      content="Estimate potassium gap, additive guidance, and hourly delivery for correction planning."
    />
    <meta
      property="og:url"
      content="https://parthchaudhari.com/tools/electrolyte-replacement-planner.html"
    />
    <link rel="canonical" href="https://parthchaudhari.com/tools/electrolyte-replacement-planner.html" />
    <link rel="stylesheet" href="/assets/css/tokens.css" />
    <link rel="stylesheet" href="/assets/css/portal.css" />
    <link rel="stylesheet" href="/assets/css/calculator-dashboard.css" />
    <script src="/assets/js/nav-status.js" defer></script>
    <script src="/assets/js/legal-compliance.js" defer></script>
    <script src="/assets/js/electrolyte-replacement-planner.js" defer></script>
    <script src="/assets/js/preferences.js" defer></script>
    <script src="/assets/js/auth-system.js" defer></script>
    <script src="/assets/js/animations.js" defer></script>
  </head>
  <body class="pc-page pc-page--study no-js">
      <div class="pc-float-shape pc-float-shape--1"></div>
      <div class="pc-float-shape pc-float-shape--2"></div>
    </div>

      <div class="pc-ambient-orb pc-ambient-orb--1"></div>
      <div class="pc-ambient-orb pc-ambient-orb--2"></div>
      <div class="pc-ambient-orb pc-ambient-orb--3"></div>
      <div class="pc-ambient-shape pc-ambient-shape--circle"></div>
      <div class="pc-ambient-shape pc-ambient-shape--square"></div>
      <div class="pc-ambient-shape pc-ambient-shape--triangle"></div>
      </div>
    </div>
    

    <div class="pc-toast-container" role="status" aria-live="polite" aria-atomic="true"></div>
    <!-- Mobile Menu Overlay -->
    <div class="pc-mobile-menu-overlay" aria-hidden="true"></div>
    

    
    <a class="pc-skip-link" href="#pc-main">Skip to main content</a>
    
    <nav class="pc-portal-nav" aria-label="Global portal navigation">
      <div class="pc-portal-nav__inner">
        <a class="pc-logo" href="/">
          <span class="pc-logo__icon">üêæ</span>
          <span class="pc-logo__text">VetLudics</span>
        </a>

        <!-- Search Bar (Desktop) -->
        <form class="pc-nav-search" action="/search.html" method="get" role="search">
          <div class="pc-search-wrapper">
            <svg class="pc-search-icon" width="18" height="18" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
            </svg>
            <input 
              type="search" 
              name="q" 
              class="pc-search-input pc-search-input--nav" 
              placeholder="Search calculators, topics..."
              aria-label="Search veterinary calculators"
              autocomplete="off"
            >
            <kbd class="pc-search-shortcut">‚åòK</kbd>
          </div>
        </form>
        <div class="pc-nav-group">
          <a class="pc-nav-link pc-nav-link--hide-mobile" href="/play/">Play</a>
          <a class="pc-nav-link pc-nav-link--hide-mobile" href="/bridge/">Bridge</a>
          <a class="pc-nav-link" href="/search.html">Search</a>
          <a class="pc-nav-link pc-nav-link--hide-mobile" href="/study/">Study</a>
          <a class="pc-nav-link" href="/account/">
            <span class="pc-auth-indicator" data-pc-auth-indicator aria-hidden="true">‚óã</span>
            <span class="pc-nav-link__text">Account</span>
          </a>
          <!-- Mobile Menu Toggle -->
          <button type="button" class="pc-mobile-toggle" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="pc-mobile-menu">
            <span class="pc-mobile-toggle__bar"></span>
            <span class="pc-mobile-toggle__bar"></span>
            <span class="pc-mobile-toggle__bar"></span>
          </button>

        </div>
      </div>
    </nav>

    <main id="pc-main" class="pc-calc-dashboard" role="main" style="padding-top: calc(5rem + env(safe-area-inset-top));">
      <!-- Header -->
      <header class="pc-calc-header pc-calc-animate">
        <div class="pc-calc-header__title">
          <div class="pc-calc-header__icon">‚ö°</div>
          <div class="pc-calc-header__text">
            <h1>Electrolyte Replacement Planner</h1>
            <p>Potassium correction & additive calculations</p>
          </div>
        </div>
        <div class="pc-calc-header__actions">
          <div class="pc-calc-quick-actions">
            <button type="button" class="pc-calc-action-btn" onclick="resetCalculator()" title="Reset all fields">
              <span>‚Ü∫</span> Reset
            </button>
            <button type="button" class="pc-calc-action-btn" onclick="toggleAutoCalc()" id="auto-calc-btn" title="Toggle auto-calculation">
              <span>‚ö°</span> <span id="auto-calc-text">Auto: On</span>
            </button>
            <a href="/tools/" class="pc-calc-action-btn">
              <span>‚Üê</span> Back
            </a>
          </div>
        </div>
      </header>

      <!-- Input Panel -->
      <aside class="pc-calc-inputs pc-calc-animate pc-calc-animate--1" aria-label="Calculator inputs">
        <div class="pc-calc-panel">
          <div class="pc-calc-panel__header">
            <span class="pc-calc-panel__title">
              <span class="pc-calc-panel__icon">üìù</span>
              Patient & Electrolytes
            </span>
          </div>
          <div class="pc-calc-panel__content">
            <form id="erp-form" novalidate>
              <!-- Weight -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Weight</span>
                  <span class="pc-calc-field__hint">kg</span>
                </div>
                <input id="erp-weight" class="pc-calc-input pc-calc-input--number" type="number" min="0.5" step="0.1" value="10" required oninput="onInputChange()" />
                <div class="pc-calc-chips">
                  <button type="button" class="pc-calc-chip" onclick="setWeight(2.5)">2.5</button>
                  <button type="button" class="pc-calc-chip" onclick="setWeight(5)">5</button>
                  <button type="button" class="pc-calc-chip pc-calc-chip--active" onclick="setWeight(10)">10</button>
                  <button type="button" class="pc-calc-chip" onclick="setWeight(20)">20</button>
                  <button type="button" class="pc-calc-chip" onclick="setWeight(30)">30</button>
                </div>
              </div>

              <!-- Current Potassium -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Current Potassium</span>
                  <span class="pc-calc-field__hint">mEq/L</span>
                </div>
                <input id="erp-current-k" class="pc-calc-input pc-calc-input--number" type="number" min="1" step="0.1" value="2.8" required oninput="onInputChange()" />
                <div class="pc-calc-chips">
                  <button type="button" class="pc-calc-chip" onclick="setCurrentK(2.0)">2.0</button>
                  <button type="button" class="pc-calc-chip" onclick="setCurrentK(2.5)">2.5</button>
                  <button type="button" class="pc-calc-chip pc-calc-chip--active" onclick="setCurrentK(2.8)">2.8</button>
                  <button type="button" class="pc-calc-chip" onclick="setCurrentK(3.0)">3.0</button>
                  <button type="button" class="pc-calc-chip" onclick="setCurrentK(3.5)">3.5</button>
                </div>
              </div>

              <!-- Target Potassium -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Target Potassium</span>
                  <span class="pc-calc-field__hint">mEq/L</span>
                </div>
                <input id="erp-target-k" class="pc-calc-input pc-calc-input--number" type="number" min="1" step="0.1" value="3.8" required oninput="onInputChange()" />
                <div class="pc-calc-chips">
                  <button type="button" class="pc-calc-chip" onclick="setTargetK(3.5)">3.5</button>
                  <button type="button" class="pc-calc-chip pc-calc-chip--active" onclick="setTargetK(3.8)">3.8</button>
                  <button type="button" class="pc-calc-chip" onclick="setTargetK(4.0)">4.0</button>
                  <button type="button" class="pc-calc-chip" onclick="setTargetK(4.5)">4.5</button>
                  <button type="button" class="pc-calc-chip" onclick="setTargetK(5.0)">5.0</button>
                </div>
              </div>

              <!-- Fluid Rate -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Fluid Rate</span>
                  <span class="pc-calc-field__hint">mL/hr</span>
                </div>
                <input id="erp-fluid-rate" class="pc-calc-input pc-calc-input--number" type="number" min="1" step="1" value="40" required oninput="onInputChange()" />
                <div class="pc-calc-chips">
                  <button type="button" class="pc-calc-chip" onclick="setFluidRate(20)">20</button>
                  <button type="button" class="pc-calc-chip" onclick="setFluidRate(30)">30</button>
                  <button type="button" class="pc-calc-chip pc-calc-chip--active" onclick="setFluidRate(40)">40</button>
                  <button type="button" class="pc-calc-chip" onclick="setFluidRate(60)">60</button>
                  <button type="button" class="pc-calc-chip" onclick="setFluidRate(100)">100</button>
                </div>
              </div>

              <button type="submit" class="pc-calc-submit" id="calc-btn">
                <span>üßÆ</span> Calculate Replacement Plan
              </button>
            </form>
          </div>
        </div>

        <!-- Related Tools -->
        <div class="pc-calc-panel pc-calc-animate pc-calc-animate--2">
          <div class="pc-calc-related">
            <div class="pc-calc-related__title">Related Tools</div>
            <div class="pc-calc-related__grid">
              <a href="/tools/fluid-calculator.html" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">üíß</span>
                <span>Fluids</span>
              </a>
              <a href="/tools/cri-calculator.html" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">üíâ</span>
                <span>CRI Calc</span>
              </a>
              <a href="/maintenance-fluids-guide/" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">üìö</span>
                <span>Guide</span>
              </a>
              <a href="/tools/dose-calculator.html" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">üíä</span>
                <span>Dosing</span>
              </a>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <section class="pc-calc-main pc-calc-animate pc-calc-animate--2" aria-label="Replacement protocol visualization">
        <div class="pc-calc-viz">
          <div class="pc-calc-viz__header">
            <span class="pc-calc-viz__title">Replacement Protocol</span>
          </div>

          <!-- Electrolyte Status Cards -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
            <div class="pc-calc-result-card" id="status-card">
              <div class="pc-calc-result__label">Hypokalemia Status</div>
              <div class="pc-calc-result__value" style="font-size: 1.25rem;" id="k-status">--</div>
              <div class="pc-calc-result__context" id="k-status-desc">Enter values to assess</div>
            </div>
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">Daily Requirement</div>
              <div class="pc-calc-result__value" style="font-size: 1.25rem;">
                <span id="daily-k-req">--</span>
                <span class="pc-calc-result__unit">mEq/day</span>
              </div>
              <div class="pc-calc-result__context">For maintenance</div>
            </div>
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">Max Safe Rate</div>
              <div class="pc-calc-result__value" style="font-size: 1.25rem;">
                <span id="max-k-rate">0.5</span>
                <span class="pc-calc-result__unit">mEq/kg/hr</span>
              </div>
              <div class="pc-calc-result__context">Do not exceed</div>
            </div>
          </div>

          <!-- Formula Display -->
          <div class="pc-calc-formula">
            <div class="pc-calc-formula__label">Calculation Formula</div>
            <div class="pc-calc-formula__math" id="formula-display">
              <span class="pc-calc-formula__highlight">K Gap</span> = Target K - Current K (mEq/L)<br>
              <span class="pc-calc-formula__highlight">Additive</span> = Gap √ó 0.3 √ó Weight (conservative)<br>
              <span class="pc-calc-formula__highlight">Hourly Delivery</span> = (Additive √ó Fluid Rate) √∑ 1000 mL
            </div>
          </div>

          <!-- Safety Alert -->
          <div id="safety-alert" class="pc-calc-alert pc-calc-alert--warning" style="display: none;">
            <div class="pc-calc-alert__icon">‚ö†Ô∏è</div>
            <div class="pc-calc-alert__content">
              <div class="pc-calc-alert__title">Safety Check</div>
              <div class="pc-calc-alert__text" id="alert-text">
                Monitor ECG during potassium replacement. Severe hypokalemia (&lt;2.5 mEq/L) requires careful correction.
              </div>
            </div>
          </div>

          <!-- Reference Table -->
          <div class="pc-calc-drug-info" style="margin-bottom: 1rem;">
            <div style="font-size: 0.75rem; font-weight: 600; color: var(--calc-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
              üìã Potassium Replacement Guidelines
            </div>
            <div style="font-size: 0.75rem; line-height: 1.6;">
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>&lt; 2.0 mEq/L</span>
                <span style="font-weight: 500; color: var(--calc-danger);">Critical - ICU monitoring</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>2.0 - 2.5 mEq/L</span>
                <span style="font-weight: 500; color: var(--calc-warning);">Severe - Aggressive Rx</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>2.5 - 3.0 mEq/L</span>
                <span style="font-weight: 500;">Moderate - Standard Rx</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>3.0 - 3.5 mEq/L</span>
                <span style="font-weight: 500; color: var(--calc-success);">Mild - Diet/fluids</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0;">
                <span>3.5 - 5.5 mEq/L</span>
                <span style="font-weight: 500; color: var(--calc-success);">Normal range</span>
              </div>
            </div>
          </div>

          <!-- Quick Tips -->
          <div style="margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--calc-glass-border);">
            <div style="font-size: 0.75rem; font-weight: 600; color: var(--calc-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
              üí° Clinical Pearls
            </div>
            <ul style="font-size: 0.8125rem; color: var(--calc-text-muted); line-height: 1.8; margin: 0; padding-left: 1.25rem;">
              <li>Never give potassium > 0.5 mEq/kg/hr IV (cardiac arrest risk)</li>
              <li>Correct magnesium if concurrently low (impairs K repletion)</li>
              <li>Use concentrated KCl only through central lines</li>
              <li>Recheck electrolytes q4-6h during aggressive correction</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Results Panel -->
      <aside class="pc-calc-results pc-calc-animate pc-calc-animate--3" aria-label="Calculation results" aria-live="polite">
        <div class="pc-calc-panel">
          <div class="pc-calc-panel__header">
            <span class="pc-calc-panel__title">
              <span class="pc-calc-panel__icon">üìä</span>
              Results
            </span>
            <button type="button" class="pc-calc-copy" onclick="copyResults()" title="Copy results">
              üìã
            </button>
          </div>
          <div class="pc-calc-panel__content">
            <!-- Primary Result -->
            <div class="pc-calc-result-card pc-calc-result-card--primary" id="result-primary">
              <div class="pc-calc-result__label">
                <span>‚ö°</span> Suggested Additive
              </div>
              <div class="pc-calc-result__value">
                <span id="erp-additive">--</span>
                <span class="pc-calc-result__unit">mEq/L</span>
              </div>
              <div class="pc-calc-result__context" id="additive-context">Add to fluids</div>
            </div>

            <!-- Secondary Results -->
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">
                <span>üìâ</span> Potassium Gap
              </div>
              <div class="pc-calc-result__value">
                <span id="erp-deficit">--</span>
                <span class="pc-calc-result__unit">mEq/L</span>
              </div>
              <div class="pc-calc-result__context">Deficit to correct</div>
            </div>

            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">
                <span>‚è±Ô∏è</span> Estimated Hourly Delivery
              </div>
              <div class="pc-calc-result__value">
                <span id="erp-hourly">--</span>
                <span class="pc-calc-result__unit">mEq/hr</span>
              </div>
              <div class="pc-calc-result__context" id="hourly-context">At current fluid rate</div>
            </div>

            <div class="pc-calc-result-card pc-calc-result-card--success">
              <div class="pc-calc-result__label">
                <span>‚úì</span> Total Daily K+ Delivery
              </div>
              <div class="pc-calc-result__value">
                <span id="erp-total-daily">--</span>
                <span class="pc-calc-result__unit">mEq/day</span>
              </div>
              <div class="pc-calc-result__context">24-hour total</div>
            </div>

            <!-- Progress indicator -->
            <div class="pc-calc-progress" style="margin-top: 1rem;">
              <div class="pc-calc-progress__bar" id="calc-progress" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- KCl Concentration Reference -->
        <div class="pc-calc-panel pc-calc-animate pc-calc-animate--4">
          <div class="pc-calc-panel__content" style="padding: 1rem;">
            <div style="font-size: 0.75rem; font-weight: 600; color: var(--calc-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
              üíâ KCl Concentrations
            </div>
            <div style="font-size: 0.75rem; line-height: 1.6;">
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>2 mEq KCl</span>
                <span style="font-weight: 500;">= 1 mL (vial)</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>20 mEq KCl</span>
                <span style="font-weight: 500;">= 10 mL (vial)</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>40 mEq KCl</span>
                <span style="font-weight: 500;">= 20 mL (vial)</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0;">
                <span>Max in 1L fluids</span>
                <span style="font-weight: 500; color: var(--calc-warning);">80 mEq (peripheral)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Disclaimer -->
        <div style="padding: 0.75rem; font-size: 0.6875rem; color: var(--calc-text-muted); text-align: center; line-height: 1.5;">
          Educational estimate only. Validate additive concentration, infusion pump settings, and ECG/serum trends before treatment changes.
        </div>
      </aside>
    </main>

    <footer class="pc-footer pc-footer--enhanced pc-footer--minimal" style="margin-top: 0;">
      <div class="pc-footer__bottom">
        <div class="pc-footer__legal">
          <a href="/">Home</a>
          <a href="/tools/">Tools</a>
          <a href="/reference/">References</a>
          <a href="/privacy/">Privacy</a>
        </div>
        <p class="pc-footer__copyright">¬© 2025 VetLudics. Not a substitute for professional veterinary advice.</p>
      </div>
    </footer>

    <script>
      // Auto-calculation toggle
      let autoCalcEnabled = true;
      
      function toggleAutoCalc() {
        autoCalcEnabled = !autoCalcEnabled;
        document.getElementById('auto-calc-text').textContent = autoCalcEnabled ? 'Auto: On' : 'Auto: Off';
        document.getElementById('auto-calc-btn').classList.toggle('pc-calc-chip--active', autoCalcEnabled);
        if (autoCalcEnabled) {
          calculateReplacement();
        }
      }

      // Input change handler
      function onInputChange() {
        updateProgress();
        if (autoCalcEnabled) {
          calculateReplacement();
        }
      }

      // Update progress bar
      function updateProgress() {
        const weight = document.getElementById('erp-weight').value;
        const currentK = document.getElementById('erp-current-k').value;
        const targetK = document.getElementById('erp-target-k').value;
        const fluidRate = document.getElementById('erp-fluid-rate').value;
        
        let progress = 0;
        if (weight) progress += 25;
        if (currentK) progress += 25;
        if (targetK) progress += 25;
        if (fluidRate) progress += 25;
        
        document.getElementById('calc-progress').style.width = progress + '%';
      }

      // Set weight from chip
      function setWeight(weight) {
        document.getElementById('erp-weight').value = weight;
        onInputChange();
        updateChipState(event.target);
      }

      // Set current potassium from chip
      function setCurrentK(k) {
        document.getElementById('erp-current-k').value = k;
        onInputChange();
        updateChipState(event.target);
      }

      // Set target potassium from chip
      function setTargetK(k) {
        document.getElementById('erp-target-k').value = k;
        onInputChange();
        updateChipState(event.target);
      }

      // Set fluid rate from chip
      function setFluidRate(rate) {
        document.getElementById('erp-fluid-rate').value = rate;
        onInputChange();
        updateChipState(event.target);
      }

      // Update chip visual state
      function updateChipState(clickedChip) {
        const parent = clickedChip.parentElement;
        parent.querySelectorAll('.pc-calc-chip').forEach(chip => {
          chip.classList.remove('pc-calc-chip--active');
        });
        clickedChip.classList.add('pc-calc-chip--active');
      }

      // Calculate replacement plan
      function calculateReplacement() {
        const weight = parseFloat(document.getElementById('erp-weight').value) || 0;
        const currentK = parseFloat(document.getElementById('erp-current-k').value) || 0;
        const targetK = parseFloat(document.getElementById('erp-target-k').value) || 0;
        const fluidRate = parseFloat(document.getElementById('erp-fluid-rate').value) || 0;

        if (!weight || !currentK || !targetK || !fluidRate) {
          return;
        }

        // Calculate potassium gap
        const kGap = targetK - currentK;
        
        // Suggested additive (conservative: gap √ó 0.3 √ó weight factor)
        // This is a simplified approach - clinical judgment required
        let additive = 0;
        if (kGap > 0) {
          // Rough estimate: for each 0.1 mEq/L deficit, add ~0.3 mEq/L to fluids
          additive = Math.min(kGap * 10, 80); // Cap at 80 mEq/L for peripheral lines
        }
        
        // Hourly delivery at current fluid rate
        const hourlyDelivery = (additive * fluidRate) / 1000;
        
        // Total daily delivery
        const totalDaily = hourlyDelivery * 24;
        
        // Daily requirement for maintenance (approx 0.5 mEq/kg/day)
        const dailyReq = weight * 0.5;

        // Update results
        document.getElementById('erp-deficit').textContent = kGap.toFixed(1);
        document.getElementById('erp-additive').textContent = additive > 0 ? additive.toFixed(1) : '0';
        document.getElementById('erp-hourly').textContent = hourlyDelivery > 0 ? hourlyDelivery.toFixed(2) : '0';
        document.getElementById('erp-total-daily').textContent = totalDaily > 0 ? totalDaily.toFixed(1) : '0';
        document.getElementById('daily-k-req').textContent = dailyReq.toFixed(1);

        // Update context text
        document.getElementById('additive-context').textContent = additive > 0 
          ? `Add ${additive.toFixed(1)} mEq KCl per liter` 
          : 'No supplementation needed';
        document.getElementById('hourly-context').textContent = `At ${fluidRate} mL/hr fluid rate`;

        // Update status card
        updateKStatus(currentK);

        // Show safety alert for severe hypokalemia
        const safetyAlert = document.getElementById('safety-alert');
        if (currentK < 2.5) {
          safetyAlert.style.display = 'flex';
          document.getElementById('alert-text').textContent = 
            `Severe hypokalemia (${currentK} mEq/L) detected. Requires ICU monitoring and ECG surveillance during replacement.`;
        } else if (currentK < 3.0) {
          safetyAlert.style.display = 'flex';
          document.getElementById('alert-text').textContent = 
            `Moderate hypokalemia (${currentK} mEq/L). Monitor ECG and recheck electrolytes q4-6h.`;
        } else {
          safetyAlert.style.display = 'none';
        }
      }

      // Update potassium status display
      function updateKStatus(k) {
        const statusEl = document.getElementById('k-status');
        const descEl = document.getElementById('k-status-desc');
        const card = document.getElementById('status-card');
        
        if (k < 2.0) {
          statusEl.textContent = 'Critical';
          statusEl.style.color = 'var(--calc-danger)';
          descEl.textContent = '< 2.0 mEq/L - Emergency';
          card.style.borderColor = 'var(--calc-danger)';
        } else if (k < 2.5) {
          statusEl.textContent = 'Severe';
          statusEl.style.color = 'var(--calc-danger)';
          descEl.textContent = '2.0-2.5 mEq/L - ICU care';
          card.style.borderColor = 'var(--calc-danger)';
        } else if (k < 3.0) {
          statusEl.textContent = 'Moderate';
          statusEl.style.color = 'var(--calc-warning)';
          descEl.textContent = '2.5-3.0 mEq/L - Treatment';
          card.style.borderColor = 'var(--calc-warning)';
        } else if (k < 3.5) {
          statusEl.textContent = 'Mild';
          statusEl.style.color = 'var(--calc-success)';
          descEl.textContent = '3.0-3.5 mEq/L - Monitor';
          card.style.borderColor = 'var(--calc-success)';
        } else if (k <= 5.5) {
          statusEl.textContent = 'Normal';
          statusEl.style.color = 'var(--calc-success)';
          descEl.textContent = '3.5-5.5 mEq/L - OK';
          card.style.borderColor = 'var(--calc-success)';
        } else {
          statusEl.textContent = 'High';
          statusEl.style.color = 'var(--calc-danger)';
          descEl.textContent = '> 5.5 mEq/L - Check for hyperK';
          card.style.borderColor = 'var(--calc-danger)';
        }
      }

      // Reset calculator
      function resetCalculator() {
        document.getElementById('erp-weight').value = '10';
        document.getElementById('erp-current-k').value = '2.8';
        document.getElementById('erp-target-k').value = '3.8';
        document.getElementById('erp-fluid-rate').value = '40';
        
        // Reset chip states
        document.querySelectorAll('.pc-calc-chips').forEach(container => {
          container.querySelectorAll('.pc-calc-chip').forEach((chip, index) => {
            chip.classList.remove('pc-calc-chip--active');
            // Activate middle chip as default
            if (index === 2) chip.classList.add('pc-calc-chip--active');
          });
        });
        
        // Reset results
        document.getElementById('erp-deficit').textContent = '--';
        document.getElementById('erp-additive').textContent = '--';
        document.getElementById('erp-hourly').textContent = '--';
        document.getElementById('erp-total-daily').textContent = '--';
        document.getElementById('daily-k-req').textContent = '--';
        document.getElementById('k-status').textContent = '--';
        document.getElementById('k-status-desc').textContent = 'Enter values to assess';
        document.getElementById('status-card').style.borderColor = '';
        document.getElementById('safety-alert').style.display = 'none';
        document.getElementById('calc-progress').style.width = '0%';
        
        showToast('Calculator reset', 'info');
      }

      // Copy results
      function copyResults() {
        const deficit = document.getElementById('erp-deficit').textContent;
        const additive = document.getElementById('erp-additive').textContent;
        const hourly = document.getElementById('erp-hourly').textContent;
        const weight = document.getElementById('erp-weight').value;
        
        const text = `K+ Replacement (${weight}kg): Gap ${deficit} mEq/L | Add ${additive} mEq/L to fluids | ${hourly} mEq/hr delivery`;
        
        navigator.clipboard.writeText(text).then(() => {
          const btn = document.querySelector('.pc-calc-copy');
          btn.classList.add('pc-calc-copy--copied');
          btn.textContent = '‚úì';
          showToast('Results copied to clipboard', 'success');
          setTimeout(() => {
            btn.classList.remove('pc-calc-copy--copied');
            btn.textContent = 'üìã';
          }, 2000);
        });
      }

      // Toast notification
      function showToast(message, type = 'info') {
        const container = document.querySelector('.pc-toast-container');
        const toast = document.createElement('div');
        toast.className = `pc-toast pc-toast--${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        
        setTimeout(() => {
          toast.classList.add('pc-toast--show');
        }, 10);
        
        setTimeout(() => {
          toast.classList.remove('pc-toast--show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Handle form submit
      document.getElementById('erp-form').addEventListener('submit', function(e) {
        e.preventDefault();
        calculateReplacement();
        showToast('Replacement plan calculated', 'success');
      });

      // Initial calculation
      document.addEventListener('DOMContentLoaded', function() {
        updateProgress();
        calculateReplacement();
      });
    </script>
  </body>
</html>
