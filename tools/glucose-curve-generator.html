<!doctype html>
<html lang="en" data-mode="pro" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author-status" content="NAVLE-candidate-unlicensed" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <link rel="icon" type="image/svg+xml" href="/assets/img/vet-favicon.svg" />
    <title>Glucose Curve Generator | VetLudics Tools</title>
    <meta name="description" content="Generate and interpret veterinary glucose curves with nadir timing, range checks, and insulin adjustment prompts." />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Glucose Curve Generator | VetLudics Tools" />
    <meta property="og:description" content="Input serial glucose values and get rapid curve interpretation." />
    <meta property="og:url" content="https://parthchaudhari.com/tools/glucose-curve-generator.html" />
    <link rel="canonical" href="https://parthchaudhari.com/tools/glucose-curve-generator.html" />
    <link rel="stylesheet" href="/assets/css/tokens.css" />
    <link rel="stylesheet" href="/assets/css/portal.css" />
    <link rel="stylesheet" href="/assets/css/calculator-dashboard.css" />
    <link rel="stylesheet" href="/assets/css/calculator-print.css" media="print" />
    <script src="/assets/js/calculator-print.js" defer></script>
    <script src="/assets/js/nav-status.js" defer></script>
    <script src="/assets/js/legal-compliance.js" defer></script>
    <script src="/assets/js/glucose-curve-generator.js" defer></script>
    <script src="/assets/js/preferences.js" defer></script>
    <script src="/assets/js/auth-system.js" defer></script>
    <script src="/assets/js/animations.js" defer></script>
  </head>
  <body class="pc-page pc-page--study no-js">
      <div class="pc-float-shape pc-float-shape--1"></div>
      <div class="pc-float-shape pc-float-shape--2"></div>
    </div>

      <div class="pc-ambient-orb pc-ambient-orb--1"></div>
      <div class="pc-ambient-orb pc-ambient-orb--2"></div>
      <div class="pc-ambient-orb pc-ambient-orb--3"></div>
      <div class="pc-ambient-shape pc-ambient-shape--circle"></div>
      <div class="pc-ambient-shape pc-ambient-shape--square"></div>
      <div class="pc-ambient-shape pc-ambient-shape--triangle"></div>
      </div>
    </div>
    

    <div class="pc-toast-container" role="status" aria-live="polite" aria-atomic="true"></div>
    <!-- Mobile Menu Overlay -->
    <div class="pc-mobile-menu-overlay" aria-hidden="true"></div>
    

    
    <a class="pc-skip-link" href="#pc-main">Skip to main content</a>
    
    <nav class="pc-portal-nav" aria-label="Global portal navigation">
      <div class="pc-portal-nav__inner">
        <a class="pc-logo" href="/">
          <span class="pc-logo__icon">ğŸ¾</span>
          <span class="pc-logo__text">VetLudics</span>
        </a>

        <!-- Search Bar (Desktop) -->
        <form class="pc-nav-search" action="/search.html" method="get" role="search">
          <div class="pc-search-wrapper">
            <svg class="pc-search-icon" width="18" height="18" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
            </svg>
            <input 
              type="search" 
              name="q" 
              class="pc-search-input pc-search-input--nav" 
              placeholder="Search calculators, topics..."
              aria-label="Search veterinary calculators"
              autocomplete="off"
            >
            <kbd class="pc-search-shortcut">âŒ˜K</kbd>
          </div>
        </form>
        <div class="pc-nav-group">
          <a class="pc-nav-link pc-nav-link--hide-mobile" href="/play/">Play</a>
          <a class="pc-nav-link pc-nav-link--hide-mobile" href="/bridge/">Bridge</a>
          <a class="pc-nav-link" href="/search.html">Search</a>
          <a class="pc-nav-link pc-nav-link--hide-mobile" href="/study/">Study</a>
          <a class="pc-nav-link" href="/account/">
            <span class="pc-auth-indicator" data-pc-auth-indicator aria-hidden="true">â—‹</span>
            <span class="pc-nav-link__text">Account</span>
          </a>
          <button type="button" class="pc-nav-toggle pc-theme-toggle" data-pc-theme-toggle aria-label="Toggle theme">
            <span class="pc-theme-icon pc-theme-icon--sun" aria-hidden="true">â˜€ï¸</span>
            <span class="pc-theme-icon pc-theme-icon--moon" aria-hidden="true">ğŸŒ™</span>
            <span class="pc-nav-toggle__label" data-pc-theme-label>Day</span></button>
          <!-- Mobile Menu Toggle -->
          <button type="button" class="pc-mobile-toggle" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="pc-mobile-menu">
            <span class="pc-mobile-toggle__bar"></span>
            <span class="pc-mobile-toggle__bar"></span>
            <span class="pc-mobile-toggle__bar"></span>
          </button>

        </div>
      </div>
    </nav>

    <main id="pc-main" class="pc-calc-dashboard" role="main" style="padding-top: calc(5rem + env(safe-area-inset-top));">
      <!-- Header -->
      <header class="pc-calc-header pc-calc-animate">
        <div class="pc-calc-header__title">
          <div class="pc-calc-header__icon">ğŸ“ˆ</div>
          <div class="pc-calc-header__text">
            <h1>Glucose Curve Generator</h1>
            <p>Nadir timing, control quality & insulin adjustments</p>
          </div>
        </div>
        <div class="pc-calc-header__actions">
          <div class="pc-calc-quick-actions">
            <button type="button" class="pc-calc-action-btn" onclick="resetCalculator()" title="Reset all fields">
              <span>â†º</span> Reset
            </button>
            <button type="button" class="pc-calc-action-btn" onclick="toggleAutoCalc()" id="auto-calc-btn" title="Toggle auto-calculation">
              <span>âš¡</span> <span id="auto-calc-text">Auto: On</span>
            </button>
            <a href="/tools/" class="pc-calc-action-btn">
              <span>â†</span> Back
            </a>
            <button type="button" class="pc-calc-action-btn" onclick="CalculatorPrint.printCalculator('glucose')" title="Print results">
              <span>ğŸ–¨ï¸</span> Print
            </button>
          </div>
        </div>
      </header>

      <!-- Input Panel -->
      <aside class="pc-calc-inputs pc-calc-animate pc-calc-animate--1" aria-label="Calculator inputs">
        <div class="pc-calc-panel">
          <div class="pc-calc-panel__header">
            <span class="pc-calc-panel__title">
              <span class="pc-calc-panel__icon">ğŸ“</span>
              Patient & Curve Data
            </span>
          </div>
          <div class="pc-calc-panel__content">
            <form id="gc-form" novalidate>
              <!-- Species -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Species</span>
                </div>
                <select id="gc-species" class="pc-calc-input" onchange="onInputChange()">
                  <option value="dog" selected>ğŸ• Dog</option>
                  <option value="cat">ğŸˆ Cat</option>
                </select>
              </div>

              <!-- Insulin Type -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Insulin Type</span>
                </div>
                <select id="gc-insulin-type" class="pc-calc-input" onchange="onInputChange()">
                  <option value="caninsulin">Caninsulin / Vetsulin</option>
                  <option value="glargine">Glargine</option>
                  <option value="detemir">Detemir</option>
                  <option value="pzi">PZI</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <!-- Insulin Dose -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Dose</span>
                  <span class="pc-calc-field__hint">U/kg</span>
                </div>
                <input id="gc-insulin-dose" class="pc-calc-input pc-calc-input--number" type="number" min="0" step="0.01" placeholder="0.3" oninput="onInputChange()" />
              </div>

              <!-- Time Points -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Time Points</span>
                  <span class="pc-calc-field__hint">hours (comma-separated)</span>
                </div>
                <input id="gc-timepoints" class="pc-calc-input" type="text" value="0,2,4,6,8,10,12" placeholder="e.g. 0,2,4,6,8,10,12" oninput="onInputChange()" />
              </div>

              <!-- Glucose Values -->
              <div class="pc-calc-field">
                <div class="pc-calc-field__label">
                  <span>Glucose Values</span>
                  <span class="pc-calc-field__hint">mg/dL (comma-separated)</span>
                </div>
                <input id="gc-values" class="pc-calc-input" type="text" value="410,320,210,140,110,190,300" placeholder="e.g. 410,320,210,140,110,190,300" oninput="onInputChange()" />
                <div class="pc-calc-chips">
                  <button type="button" class="pc-calc-chip" onclick="addGlucoseValue(100)">100</button>
                  <button type="button" class="pc-calc-chip" onclick="addGlucoseValue(150)">150</button>
                  <button type="button" class="pc-calc-chip" onclick="addGlucoseValue(200)">200</button>
                  <button type="button" class="pc-calc-chip" onclick="addGlucoseValue(250)">250</button>
                  <button type="button" class="pc-calc-chip" onclick="addGlucoseValue(300)">300</button>
                </div>
              </div>

              <button type="submit" class="pc-calc-submit" id="calc-btn">
                <span>ğŸ“ˆ</span> Generate Curve
              </button>
            </form>
          </div>
        </div>

        <!-- Related Tools -->
        <div class="pc-calc-panel pc-calc-animate pc-calc-animate--2">
          <div class="pc-calc-related">
            <div class="pc-calc-related__title">Related Tools</div>
            <div class="pc-calc-related__grid">
              <a href="/tools/dose-calculator.html" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">ğŸ’Š</span>
                <span>Dosing</span>
              </a>
              <a href="/tools/fluid-calculator.html" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">ğŸ’§</span>
                <span>Fluids</span>
              </a>
              <a href="/tools/cri-calculator.html" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">ğŸ’‰</span>
                <span>CRI Calc</span>
              </a>
              <a href="/dka-approach-veterinary/" class="pc-calc-related__item">
                <span class="pc-calc-related__icon">ğŸ“š</span>
                <span>DKA Guide</span>
              </a>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <section class="pc-calc-main pc-calc-animate pc-calc-animate--2" aria-label="Glucose curve visualization">
        <div class="pc-calc-viz">
          <div class="pc-calc-viz__header">
            <span class="pc-calc-viz__title">Glucose Curve Visualization</span>
          </div>

          <!-- Curve Chart Container -->
          <div id="gc-curve-container" style="background: var(--calc-glass-bg); border: 1px solid var(--calc-glass-border); border-radius: var(--calc-radius); padding: 1rem; margin-bottom: 1rem; min-height: 250px; display: flex; align-items: center; justify-content: center;">
            <svg id="gc-curve-svg" viewBox="0 0 600 200" style="width: 100%; height: 200px;">
              <!-- Grid lines -->
              <line x1="50" y1="20" x2="550" y2="20" stroke="var(--calc-glass-border)" stroke-dasharray="2,2"/>
              <line x1="50" y1="70" x2="550" y2="70" stroke="var(--calc-glass-border)" stroke-dasharray="2,2"/>
              <line x1="50" y1="120" x2="550" y2="120" stroke="var(--calc-glass-border)" stroke-dasharray="2,2"/>
              <line x1="50" y1="170" x2="550" y2="170" stroke="var(--calc-glass-border)" stroke-dasharray="2,2"/>
              
              <!-- Target range band -->
              <rect id="gc-target-band" x="50" y="85" width="500" height="35" fill="rgba(16, 185, 129, 0.15)" rx="4"/>
              
              <!-- Axes -->
              <line x1="50" y1="20" x2="50" y2="170" stroke="var(--calc-text-muted)" stroke-width="2"/>
              <line x1="50" y1="170" x2="550" y2="170" stroke="var(--calc-text-muted)" stroke-width="2"/>
              
              <!-- Y-axis labels -->
              <text x="40" y="25" text-anchor="end" font-size="10" fill="var(--calc-text-muted)">500</text>
              <text x="40" y="75" text-anchor="end" font-size="10" fill="var(--calc-text-muted)">300</text>
              <text x="40" y="125" text-anchor="end" font-size="10" fill="var(--calc-text-muted)">150</text>
              <text x="40" y="175" text-anchor="end" font-size="10" fill="var(--calc-text-muted)">50</text>
              
              <!-- Curve path -->
              <path id="gc-curve-path" d="" fill="none" stroke="var(--calc-primary)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
              
              <!-- Data points -->
              <g id="gc-data-points"></g>
              
              <!-- Target range label -->
              <text x="300" y="107" text-anchor="middle" font-size="11" fill="var(--calc-success)" font-weight="500">Target Range (80-180)</text>
            </svg>
          </div>

          <!-- Curve Metrics -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">Maximum</div>
              <div class="pc-calc-result__value" style="font-size: 1.5rem;">
                <span id="viz-max">--</span>
                <span class="pc-calc-result__unit">mg/dL</span>
              </div>
            </div>
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">Minimum (Nadir)</div>
              <div class="pc-calc-result__value" style="font-size: 1.5rem;">
                <span id="viz-min">--</span>
                <span class="pc-calc-result__unit">mg/dL</span>
              </div>
            </div>
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">Average</div>
              <div class="pc-calc-result__value" style="font-size: 1.5rem;">
                <span id="viz-avg">--</span>
                <span class="pc-calc-result__unit">mg/dL</span>
              </div>
            </div>
          </div>

          <!-- Formula Display -->
          <div class="pc-calc-formula">
            <div class="pc-calc-formula__label">Interpretation Guide</div>
            <div class="pc-calc-formula__math" id="formula-display">
              <span class="pc-calc-formula__highlight">Target Range</span> = 80-180 mg/dL (dog), 80-200 mg/dL (cat)<br>
              <span class="pc-calc-formula__highlight">Nadir</span> = Lowest glucose value<br>
              <span class="pc-calc-formula__highlight">Excursion</span> = Maximum - Minimum
            </div>
          </div>

          <!-- Safety Alert -->
          <div id="gc-safety-alert" class="pc-calc-alert pc-calc-alert--warning" style="display: none;">
            <div class="pc-calc-alert__icon">âš ï¸</div>
            <div class="pc-calc-alert__content">
              <div class="pc-calc-alert__title" id="alert-title">Hypoglycemia Risk</div>
              <div class="pc-calc-alert__text" id="alert-text">Nadir below 80 mg/dL - consider dose reduction</div>
            </div>
          </div>

          <!-- Data Table -->
          <div class="pc-table-wrap" style="margin-top: 1rem;">
            <table class="pc-table" style="font-size: 0.8125rem;">
              <thead>
                <tr>
                  <th>Time (h)</th>
                  <th>Glucose (mg/dL)</th>
                  <th>Target Band</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="gc-table-body"></tbody>
            </table>
          </div>

          <!-- Quick Tips -->
          <div style="margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--calc-glass-border);">
            <div style="font-size: 0.75rem; font-weight: 600; color: var(--calc-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
              ğŸ’¡ Clinical Pearls
            </div>
            <ul style="font-size: 0.8125rem; color: var(--calc-text-muted); line-height: 1.8; margin: 0; padding-left: 1.25rem;">
              <li>Ideal nadir occurs 4-8 hours post-injection for most insulins</li>
              <li>Target 50% reduction from pre-insulin glucose at nadir</li>
              <li>If nadir &lt; 80 mg/dL â†’ reduce dose by 10-25%</li>
              <li>If nadir &gt; 180 mg/dL â†’ increase dose per protocol</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Results Panel -->
      <aside class="pc-calc-results pc-calc-animate pc-calc-animate--3" aria-label="Calculation results" aria-live="polite">
        <div class="pc-calc-panel">
          <div class="pc-calc-panel__header">
            <span class="pc-calc-panel__title">
              <span class="pc-calc-panel__icon">ğŸ“Š</span>
              Results
            </span>
            <button type="button" class="pc-calc-copy" onclick="copyResults()" title="Copy results">
              ğŸ“‹
            </button>
          </div>
          <div class="pc-calc-panel__content">
            <!-- Primary Result - Control Grade -->
            <div class="pc-calc-result-card pc-calc-result-card--primary" id="result-primary">
              <div class="pc-calc-result__label">
                <span>ğŸ“Š</span> Control Grade
              </div>
              <div class="pc-calc-result__value">
                <span id="result-grade">--</span>
              </div>
              <div class="pc-calc-result__context" id="grade-context">Enter values to assess</div>
            </div>

            <!-- Secondary Results -->
            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">
                <span>â±ï¸</span> Nadir Time
              </div>
              <div class="pc-calc-result__value">
                <span id="result-nadir-time">--</span>
                <span class="pc-calc-result__unit">h</span>
              </div>
              <div class="pc-calc-result__context">Post-injection timing</div>
            </div>

            <div class="pc-calc-result-card">
              <div class="pc-calc-result__label">
                <span>ğŸ“‰</span> Glucose Range
              </div>
              <div class="pc-calc-result__value">
                <span id="result-range">--</span>
                <span class="pc-calc-result__unit">mg/dL</span>
              </div>
              <div class="pc-calc-result__context">Max - Min</div>
            </div>

            <div class="pc-calc-result-card pc-calc-result-card--success">
              <div class="pc-calc-result__label">
                <span>âœ“</span> Points in Target
              </div>
              <div class="pc-calc-result__value">
                <span id="result-in-target">--</span>
                <span class="pc-calc-result__unit">%</span>
              </div>
              <div class="pc-calc-result__context">Time in range</div>
            </div>

            <!-- Progress indicator -->
            <div class="pc-calc-progress" style="margin-top: 1rem;">
              <div class="pc-calc-progress__bar" id="calc-progress" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Interpretation -->
        <div class="pc-calc-panel pc-calc-animate pc-calc-animate--4">
          <div class="pc-calc-panel__content" style="padding: 1rem;">
            <div style="font-size: 0.75rem; font-weight: 600; color: var(--calc-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
              ğŸ©º Interpretation
            </div>
            <div id="gc-interpretation" style="font-size: 0.8125rem; color: var(--calc-text); line-height: 1.6;">
              Enter glucose values to generate interpretation and insulin adjustment recommendations.
            </div>
          </div>
        </div>

        <!-- Target Ranges Reference -->
        <div class="pc-calc-panel pc-calc-animate pc-calc-animate--4">
          <div class="pc-calc-panel__content" style="padding: 1rem;">
            <div style="font-size: 0.75rem; font-weight: 600; color: var(--calc-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
              ğŸ¯ Target Ranges
            </div>
            <div style="font-size: 0.75rem; line-height: 1.6;">
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>Dog (general)</span>
                <span style="font-weight: 500;">80-180 mg/dL</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>Cat (general)</span>
                <span style="font-weight: 500;">80-200 mg/dL</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--calc-glass-border);">
                <span>Ideal nadir</span>
                <span style="font-weight: 500;">80-150 mg/dL</span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 0.375rem 0;">
                <span>Hypoglycemia</span>
                <span style="font-weight: 500; color: var(--calc-error);">&lt; 80 mg/dL</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Disclaimer -->
        <div style="padding: 0.75rem; font-size: 0.6875rem; color: var(--calc-text-muted); text-align: center; line-height: 1.5;">
          Educational tool only. Insulin changes must follow clinician review and patient-specific context.
        </div>
      </aside>
    </main>

    <footer class="pc-footer pc-footer--enhanced pc-footer--minimal" style="margin-top: 0;">
      <div class="pc-footer__bottom">
        <div class="pc-footer__legal">
          <a href="/">Home</a>
          <a href="/tools/">Tools</a>
          <a href="/reference/">References</a>
          <a href="/privacy/">Privacy</a>
        </div>
        <p class="pc-footer__copyright">Â© 2025 VetLudics. Not a substitute for professional veterinary advice.</p>
      </div>
    </footer>

    <script>
      // Auto-calculation toggle
      let autoCalcEnabled = true;
      
      function toggleAutoCalc() {
        autoCalcEnabled = !autoCalcEnabled;
        document.getElementById('auto-calc-text').textContent = autoCalcEnabled ? 'Auto: On' : 'Auto: Off';
        document.getElementById('auto-calc-btn').classList.toggle('pc-calc-chip--active', autoCalcEnabled);
        if (autoCalcEnabled) {
          generateCurve();
        }
      }

      // Input change handler
      function onInputChange() {
        updateProgress();
        if (autoCalcEnabled) {
          generateCurve();
        }
      }

      // Update progress bar
      function updateProgress() {
        const timepoints = document.getElementById('gc-timepoints').value;
        const values = document.getElementById('gc-values').value;
        
        let progress = 0;
        if (timepoints) progress += 50;
        if (values) progress += 50;
        
        document.getElementById('calc-progress').style.width = progress + '%';
      }

      // Add glucose value from chip
      function addGlucoseValue(value) {
        const input = document.getElementById('gc-values');
        const currentValue = input.value.trim();
        if (currentValue) {
          input.value = currentValue + ',' + value;
        } else {
          input.value = value.toString();
        }
        onInputChange();
        
        // Visual feedback
        document.querySelectorAll('.pc-calc-chip').forEach(chip => {
          chip.classList.remove('pc-calc-chip--active');
        });
        event.target.classList.add('pc-calc-chip--active');
      }

      // Reset calculator
      function resetCalculator() {
        document.getElementById('gc-species').value = 'dog';
        document.getElementById('gc-insulin-type').value = 'caninsulin';
        document.getElementById('gc-insulin-dose').value = '';
        document.getElementById('gc-timepoints').value = '0,2,4,6,8,10,12';
        document.getElementById('gc-values').value = '410,320,210,140,110,190,300';
        
        // Reset results
        document.getElementById('result-grade').textContent = '--';
        document.getElementById('grade-context').textContent = 'Enter values to assess';
        document.getElementById('result-nadir-time').textContent = '--';
        document.getElementById('result-range').textContent = '--';
        document.getElementById('result-in-target').textContent = '--';
        document.getElementById('calc-progress').style.width = '0%';
        
        // Reset visualization
        document.getElementById('viz-max').textContent = '--';
        document.getElementById('viz-min').textContent = '--';
        document.getElementById('viz-avg').textContent = '--';
        document.getElementById('gc-curve-path').setAttribute('d', '');
        document.getElementById('gc-data-points').innerHTML = '';
        document.getElementById('gc-table-body').innerHTML = '';
        document.getElementById('gc-interpretation').textContent = 'Enter glucose values to generate interpretation and insulin adjustment recommendations.';
        document.getElementById('gc-safety-alert').style.display = 'none';
        
        showToast('Calculator reset', 'info');
      }

      // Copy results
      function copyResults() {
        const grade = document.getElementById('result-grade').textContent;
        const nadirTime = document.getElementById('result-nadir-time').textContent;
        const range = document.getElementById('result-range').textContent;
        const species = document.getElementById('gc-species').value;
        
        const text = `Glucose Curve (${species}): Grade ${grade} | Nadir at ${nadirTime}h | Range ${range} mg/dL`;
        
        navigator.clipboard.writeText(text).then(() => {
          const btn = document.querySelector('.pc-calc-copy');
          btn.classList.add('pc-calc-copy--copied');
          btn.textContent = 'âœ“';
          showToast('Results copied to clipboard', 'success');
          setTimeout(() => {
            btn.classList.remove('pc-calc-copy--copied');
            btn.textContent = 'ğŸ“‹';
          }, 2000);
        });
      }

      // Generate curve (placeholder - will be overridden by glucose-curve-generator.js)
      function generateCurve() {
        const timepointsInput = document.getElementById('gc-timepoints').value;
        const valuesInput = document.getElementById('gc-values').value;
        const species = document.getElementById('gc-species').value;
        
        if (!timepointsInput || !valuesInput) return;
        
        const timepoints = timepointsInput.split(',').map(t => parseFloat(t.trim())).filter(t => !isNaN(t));
        const values = valuesInput.split(',').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
        
        if (timepoints.length !== values.length || timepoints.length === 0) return;
        
        // Calculate metrics
        const max = Math.max(...values);
        const min = Math.min(...values);
        const avg = values.reduce((a, b) => a + b, 0) / values.length;
        const range = max - min;
        const nadirIndex = values.indexOf(min);
        const nadirTime = timepoints[nadirIndex];
        
        // Target range based on species
        const targetMin = 80;
        const targetMax = species === 'cat' ? 200 : 180;
        
        // Points in target
        const inTarget = values.filter(v => v >= targetMin && v <= targetMax).length;
        const inTargetPct = Math.round((inTarget / values.length) * 100);
        
        // Grade
        let grade = 'Poor';
        if (inTargetPct >= 75 && min >= targetMin) grade = 'Good';
        else if (inTargetPct >= 50 && min >= targetMin) grade = 'Fair';
        else if (min < targetMin) grade = 'Risk';
        
        // Update visualization
        document.getElementById('viz-max').textContent = max;
        document.getElementById('viz-min').textContent = min;
        document.getElementById('viz-avg').textContent = avg.toFixed(0);
        
        // Update results
        document.getElementById('result-grade').textContent = grade;
        document.getElementById('grade-context').textContent = `${inTargetPct}% time in target`;
        document.getElementById('result-nadir-time').textContent = nadirTime;
        document.getElementById('result-range').textContent = range;
        document.getElementById('result-in-target').textContent = inTargetPct;
        
        // Draw curve
        drawCurve(timepoints, values, targetMin, targetMax);
        
        // Update table
        updateTable(timepoints, values, targetMin, targetMax);
        
        // Update interpretation
        updateInterpretation(grade, min, nadirTime, species);
        
        // Show safety alert if hypoglycemia
        if (min < 80) {
          document.getElementById('gc-safety-alert').style.display = 'flex';
          document.getElementById('alert-title').textContent = 'Hypoglycemia Risk';
          document.getElementById('alert-text').textContent = `Nadir of ${min} mg/dL below 80 - consider dose reduction`;
        } else {
          document.getElementById('gc-safety-alert').style.display = 'none';
        }
      }

      // Draw SVG curve
      function drawCurve(timepoints, values, targetMin, targetMax) {
        const svg = document.getElementById('gc-curve-svg');
        const path = document.getElementById('gc-curve-path');
        const pointsGroup = document.getElementById('gc-data-points');
        const targetBand = document.getElementById('gc-target-band');
        
        // Scale factors
        const minTime = Math.min(...timepoints);
        const maxTime = Math.max(...timepoints);
        const minVal = 50;
        const maxVal = 500;
        
        const xScale = 500 / (maxTime - minTime || 1);
        const yScale = 150 / (maxVal - minVal);
        
        // Update target band position
        const targetY = 170 - (targetMax - minVal) * yScale;
        const targetHeight = (targetMax - targetMin) * yScale;
        targetBand.setAttribute('y', targetY);
        targetBand.setAttribute('height', targetHeight);
        
        // Generate path
        let d = '';
        const points = [];
        
        timepoints.forEach((t, i) => {
          const x = 50 + (t - minTime) * xScale;
          const y = 170 - (values[i] - minVal) * yScale;
          points.push({x, y, value: values[i]});
          
          if (i === 0) {
            d += `M ${x} ${y}`;
          } else {
            // Smooth curve using quadratic bezier
            const prev = points[i-1];
            const midX = (prev.x + x) / 2;
            d += ` Q ${prev.x + (x - prev.x) / 4} ${prev.y} ${midX} ${(prev.y + y) / 2}`;
            d += ` Q ${x - (x - prev.x) / 4} ${y} ${x} ${y}`;
          }
        });
        
        path.setAttribute('d', d);
        
        // Add data points
        pointsGroup.innerHTML = '';
        points.forEach((p, i) => {
          const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          circle.setAttribute('cx', p.x);
          circle.setAttribute('cy', p.y);
          circle.setAttribute('r', '5');
          circle.setAttribute('fill', 'var(--calc-primary)');
          circle.setAttribute('stroke', 'white');
          circle.setAttribute('stroke-width', '2');
          circle.setAttribute('title', `${timepoints[i]}h: ${p.value} mg/dL`);
          pointsGroup.appendChild(circle);
          
          // Add value label
          const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text.setAttribute('x', p.x);
          text.setAttribute('y', p.y - 10);
          text.setAttribute('text-anchor', 'middle');
          text.setAttribute('font-size', '10');
          text.setAttribute('fill', 'var(--calc-text)');
          text.textContent = p.value;
          pointsGroup.appendChild(text);
        });
      }

      // Update data table
      function updateTable(timepoints, values, targetMin, targetMax) {
        const tbody = document.getElementById('gc-table-body');
        tbody.innerHTML = '';
        
        timepoints.forEach((t, i) => {
          const v = values[i];
          const inTarget = v >= targetMin && v <= targetMax;
          const status = v < targetMin ? 'Low' : (v > targetMax ? 'High' : 'Target');
          const statusColor = v < targetMin ? 'var(--calc-error)' : (v > targetMax ? 'var(--calc-warning)' : 'var(--calc-success)');
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${t}</td>
            <td><strong>${v}</strong></td>
            <td>${inTarget ? 'âœ“ In range' : '--'}</td>
            <td style="color: ${statusColor}; font-weight: 500;">${status}</td>
          `;
          tbody.appendChild(row);
        });
      }

      // Update interpretation
      function updateInterpretation(grade, nadir, nadirTime, species) {
        const interp = document.getElementById('gc-interpretation');
        const targetMax = species === 'cat' ? 200 : 180;
        
        let text = '';
        
        if (grade === 'Good') {
          text = `<strong style="color: var(--calc-success)">Good glycemic control.</strong> Nadir of ${nadir} mg/dL at ${nadirTime} hours is appropriate. Continue current protocol.`;
        } else if (grade === 'Fair') {
          text = `<strong style="color: var(--calc-warning)">Fair control.</strong> Consider fine-tuning insulin dose or timing. Monitor for trends.`;
        } else if (nadir < 80) {
          text = `<strong style="color: var(--calc-error)">Hypoglycemia risk.</strong> Nadir of ${nadir} mg/dL is below safe threshold. Reduce insulin dose by 10-25% and recheck curve in 5-7 days.`;
        } else {
          text = `<strong style="color: var(--calc-warning)">Suboptimal control.</strong> Glucose values exceed target range. Consider dose adjustment based on nadir timing.`;
        }
        
        // Add timing advice
        if (nadirTime < 4) {
          text += `<br><br>âš ï¸ <strong>Early nadir</strong> (${nadirTime}h) suggests rapid insulin absorption. Consider splitting dose or using longer-acting insulin.`;
        } else if (nadirTime > 10) {
          text += `<br><br>âš ï¸ <strong>Late nadir</strong> (${nadirTime}h) suggests prolonged insulin action. Monitor for rebound hyperglycemia (Somogyi effect).`;
        }
        
        interp.innerHTML = text;
      }

      // Toast notification
      function showToast(message, type = 'info') {
        const container = document.querySelector('.pc-toast-container');
        const toast = document.createElement('div');
        toast.className = `pc-toast pc-toast--${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        
        setTimeout(() => {
          toast.classList.add('pc-toast--show');
        }, 10);
        
        setTimeout(() => {
          toast.classList.remove('pc-toast--show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Form submission
      document.getElementById('gc-form').addEventListener('submit', function(e) {
        e.preventDefault();
        generateCurve();
        showToast('Curve generated', 'success');
      });

      // Initial progress update
      document.addEventListener('DOMContentLoaded', function() {
        updateProgress();
        generateCurve();
      });
    </script>
  </body>
</html>
