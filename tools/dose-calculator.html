<!doctype html>
<html lang="en" data-mode="pro" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dose Calculator | DVMReady</title>
    <meta name="description" content="Fast veterinary dose calculator with 50+ drugs, species-specific dosing, and live calculation." />
    <link rel="icon" type="image/png" href="/assets/img/dvmready-logo.png" />
    <style>
      * { box-sizing: border-box; }
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #0f172a;
        color: #f8fafc;
        margin: 0;
        line-height: 1.5;
        min-height: 100vh;
      }
      
      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 1rem;
      }
      
      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      h1 {
        font-size: 1.5rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      /* Navigation */
      .nav {
        display: flex;
        gap: 1rem;
      }
      
      .nav a {
        color: #94a3b8;
        text-decoration: none;
        font-size: 0.875rem;
      }
      
      .nav a:hover { color: #f8fafc; }
      
      /* Main Result Card */
      .result-card {
        background: linear-gradient(135deg, #0c607d 0%, #14a3c7 100%);
        border-radius: 16px;
        padding: 1.5rem;
        margin: 1rem 0;
        text-align: center;
        box-shadow: 0 10px 40px rgba(12, 96, 125, 0.3);
      }
      
      .result-card__label {
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        opacity: 0.9;
        margin-bottom: 0.5rem;
      }
      
      .result-card__value {
        font-size: 3.5rem;
        font-weight: 700;
        line-height: 1;
      }
      
      .result-card__unit {
        font-size: 1.5rem;
        opacity: 0.8;
      }
      
      .result-card__secondary {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255,255,255,0.2);
        display: flex;
        justify-content: center;
        gap: 2rem;
        font-size: 1.125rem;
      }
      
      .result-card__item {
        text-align: center;
      }
      
      .result-card__item-label {
        font-size: 0.75rem;
        opacity: 0.8;
        margin-bottom: 0.25rem;
      }
      
      /* Input Grid */
      .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }
      
      .field {
        display: flex;
        flex-direction: column;
        gap: 0.375rem;
      }
      
      .field label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #94a3b8;
        display: flex;
        justify-content: space-between;
      }
      
      .field input, .field select {
        padding: 0.75rem;
        border: 1px solid #334155;
        border-radius: 8px;
        background: #1e293b;
        color: #f8fafc;
        font-size: 1rem;
        transition: border-color 0.2s;
      }
      
      .field input:focus, .field select:focus {
        outline: none;
        border-color: #0c607d;
      }
      
      /* Searchable select */
      .search-wrapper {
        position: relative;
      }
      
      .search-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #334155;
        border-radius: 8px;
        background: #1e293b;
        color: #f8fafc;
        font-size: 1rem;
      }
      
      .drug-list {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        max-height: 300px;
        overflow-y: auto;
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 8px;
        margin-top: 4px;
        z-index: 100;
        display: none;
      }
      
      .drug-list.show { display: block; }
      
      .drug-option {
        padding: 0.625rem 0.75rem;
        cursor: pointer;
        border-bottom: 1px solid #334155;
      }
      
      .drug-option:hover, .drug-option.selected {
        background: #0c607d;
      }
      
      .drug-category {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-left: 0.5rem;
      }
      
      /* Unit toggle */
      .unit-toggle {
        display: flex;
        gap: 0.25rem;
        margin-top: 0.375rem;
      }
      
      .unit-btn {
        flex: 1;
        padding: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        border: 1px solid #334155;
        background: #1e293b;
        color: #94a3b8;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .unit-btn.active {
        background: #0c607d;
        color: white;
        border-color: #0c607d;
      }
      
      /* Chips */
      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.375rem;
        margin-top: 0.5rem;
      }
      
      .chip {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        border: 1px solid #334155;
        background: #1e293b;
        color: #94a3b8;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .chip:hover, .chip.active {
        background: #0c607d;
        color: white;
        border-color: #0c607d;
      }
      
      /* Drug Info Panel */
      .drug-info {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 12px;
        padding: 1rem;
        margin: 1rem 0;
      }
      
      .drug-info__header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
      }
      
      .drug-info__name {
        font-size: 1.25rem;
        font-weight: 600;
      }
      
      .drug-info__category {
        font-size: 0.75rem;
        color: #94a3b8;
        background: rgba(255,255,255,0.1);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
      }
      
      .drug-info__grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        font-size: 0.875rem;
      }
      
      .drug-info__item-label {
        color: #94a3b8;
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
      }
      
      .drug-info__item-value {
        font-weight: 500;
      }
      
      /* Alerts */
      .alert {
        padding: 0.875rem 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        display: none;
        align-items: flex-start;
        gap: 0.75rem;
      }
      
      .alert.show { display: flex; }
      
      .alert--warning {
        background: rgba(245, 158, 11, 0.1);
        border: 1px solid rgba(245, 158, 11, 0.3);
        color: #f59e0b;
      }
      
      .alert--danger {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
      }
      
      /* Extras Section */
      .extras {
        margin-top: 1rem;
      }
      
      .extras-header {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      
      .extras-btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        background: transparent;
        border: 1px solid #334155;
        color: #94a3b8;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .extras-btn:hover, .extras-btn.active {
        background: #0c607d;
        color: white;
        border-color: #0c607d;
      }
      
      .extras-content {
        display: none;
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 0.5rem;
      }
      
      .extras-content.show { display: block; }
      
      /* Tablet calculation */
      .tablet-info {
        display: none;
        margin-top: 0.5rem;
        padding: 0.75rem;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 6px;
      }
      
      .tablet-info.show { display: block; }
      
      @media (max-width: 600px) {
        .result-card__value { font-size: 2.5rem; }
        .drug-info__grid { grid-template-columns: repeat(2, 1fr); }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>üíä Dose Calculator</h1>
        <nav class="nav">
          <a href="/">‚Üê Home</a>
          <a href="/tools/">Tools</a>
        </nav>
      </div>
      
      <!-- MAIN RESULT - What doctors need FIRST -->
      <div class="result-card">
        <div class="result-card__label">Total Dose Required</div>
        <div class="result-card__value">
          <span id="result-mg">--</span>
          <span class="result-card__unit">mg</span>
        </div>
        <div class="result-card__secondary">
          <div class="result-card__item">
            <div class="result-card__item-label">Volume</div>
            <div><span id="result-ml">--</span> mL</div>
          </div>
          <div class="result-card__item">
            <div class="result-card__item-label">Frequency</div>
            <div id="result-freq">--</div>
          </div>
        </div>
      </div>
      
      <!-- Inputs -->
      <div class="input-grid">
        <!-- Species -->
        <div class="field">
          <label>Species</label>
          <select id="species" onchange="calculate()">
            <option value="dog">üêï Dog</option>
            <option value="cat">üêà Cat</option>
          </select>
        </div>
        
        <!-- Weight -->
        <div class="field">
          <label>Weight</label>
          <input id="weight" type="number" value="10" step="0.1" min="0.1" oninput="calculate()" />
          <div class="unit-toggle">
            <button type="button" class="unit-btn active" onclick="setUnit('kg')">kg</button>
            <button type="button" class="unit-btn" onclick="setUnit('lb')">lb</button>
            <button type="button" class="unit-btn" onclick="setUnit('g')">g</button>
          </div>
          <div class="chips" id="weight-chips">
            <button type="button" class="chip" onclick="setWeight(2.5)">2.5</button>
            <button type="button" class="chip" onclick="setWeight(5)">5</button>
            <button type="button" class="chip active" onclick="setWeight(10)">10</button>
            <button type="button" class="chip" onclick="setWeight(20)">20</button>
            <button type="button" class="chip" onclick="setWeight(30)">30</button>
          </div>
        </div>
        
        <!-- Drug Search -->
        <div class="field" style="grid-column: span 2;">
          <label>Drug <span style="color: #64748b;">(type to search)</span></label>
          <div class="search-wrapper">
            <input type="text" id="drug-search" class="search-input" placeholder="Search drug..." oninput="filterDrugs()" onclick="showDrugList()" />
            <div class="drug-list" id="drug-list"></div>
          </div>
          <input type="hidden" id="drug-selected" />
        </div>
        
        <!-- Concentration -->
        <div class="field">
          <label>Concentration (mg/mL)</label>
          <input id="concentration" type="number" placeholder="e.g. 50" step="0.1" oninput="calculate()" />
        </div>
        
        <!-- Tablet Size (for oral drugs) -->
        <div class="field" id="tablet-field" style="display: none;">
          <label>Tablet Size (mg) <span style="color: #64748b;">(optional)</span></label>
          <input id="tablet-size" type="number" placeholder="e.g. 25" oninput="calculate()" />
        </div>
      </div>
      
      <!-- Drug Info Panel -->
      <div class="drug-info" id="drug-info" style="display: none;">
        <div class="drug-info__header">
          <div>
            <div class="drug-info__name" id="info-name">--</div>
            <div style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.25rem;" id="info-species-dose">--</div>
          </div>
          <span class="drug-info__category" id="info-category">--</span>
        </div>
        <div class="drug-info__grid">
          <div>
            <div class="drug-info__item-label">Dose Range</div>
            <div class="drug-info__item-value" id="info-dose">--</div>
          </div>
          <div>
            <div class="drug-info__item-label">Frequency</div>
            <div class="drug-info__item-value" id="info-freq">--</div>
          </div>
          <div>
            <div class="drug-info__item-label">Max Dose</div>
            <div class="drug-info__item-value" id="info-max">--</div>
          </div>
        </div>
        <div class="tablet-info" id="tablet-info">
          <strong>üíä Tablet Equivalent:</strong> <span id="tablet-count">--</span> tablet(s) of <span id="tablet-mg">--</span> mg
        </div>
      </div>
      
      <!-- Alerts -->
      <div class="alert alert--danger" id="alert-danger">
        <span>‚ö†Ô∏è</span>
        <div>
          <strong>Max Dose Exceeded</strong><br>
          Calculated dose exceeds safe maximum. Please verify.
        </div>
      </div>
      
      <div class="alert alert--warning" id="alert-warning">
        <span>‚ö†Ô∏è</span>
        <div>
          <strong>High Dose</strong><br>
          Approaching maximum dose. Consider lower end of range.
        </div>
      </div>
      
      <!-- Extras -->
      <div class="extras">
        <div class="extras-header">
          <button type="button" class="extras-btn" onclick="toggleExtra('formula')">üìê Formula</button>
          <button type="button" class="extras-btn" onclick="toggleExtra('reference')">üìö Reference</button>
          <button type="button" class="extras-btn" onclick="toggleExtra('print')">üñ®Ô∏è Print</button>
        </div>
        
        <div class="extras-content" id="extra-formula">
          <strong>Calculation Formula:</strong><br>
          Dose (mg) = Weight (kg) √ó Dose rate (mg/kg)<br>
          Volume (mL) = Dose (mg) √∑ Concentration (mg/mL)
        </div>
        
        <div class="extras-content" id="extra-reference">
          <strong>References:</strong><br>
          ‚Ä¢ Plumb's Veterinary Drug Handbook, 10th Ed.<br>
          ‚Ä¢ Merck Veterinary Manual<br>
          ‚Ä¢ FDA Animal Drug Labels<br>
          <br>
          <em>Always verify doses against current formularies before administering.</em>
        </div>
        
        <div class="extras-content" id="extra-print">
          <button onclick="window.print()" style="padding: 0.75rem 1.5rem; background: #0c607d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
            Print Calculation
          </button>
        </div>
      </div>
    </div>
    
    <script>
      // Full drug database with species-specific dosing
      const DRUGS = {
        // Cardiology
        'Furosemide': { 
          category: 'Cardiology/Diuretic',
          dog: { dose: 2, max: 4, freq: 'BID-TID' },
          cat: { dose: 0.5, max: 2, freq: 'BID' }
        },
        'Pimobendan': { 
          category: 'Cardiology/Inotrope',
          dog: { dose: 0.25, max: 0.3, freq: 'BID' },
          cat: { dose: 0.1, max: 0.3, freq: 'BID' }
        },
        'Benazepril': { 
          category: 'Cardiology/ACE Inhibitor',
          dog: { dose: 0.25, max: 0.5, freq: 'SID' },
          cat: { dose: 0.5, max: 1, freq: 'SID' }
        },
        'Enalapril': { 
          category: 'Cardiology/ACE Inhibitor',
          dog: { dose: 0.5, max: 1, freq: 'SID-BID' },
          cat: { dose: 0.25, max: 0.5, freq: 'SID' }
        },
        'Amlodipine': { 
          category: 'Cardiology/Antihypertensive',
          dog: { dose: 0.15, max: 0.2, freq: 'SID' },
          cat: { dose: 0.1, max: 0.25, freq: 'SID' }
        },
        'Atenolol': { 
          category: 'Cardiology/Beta-blocker',
          dog: { dose: 0.5, max: 1, freq: 'BID' },
          cat: { dose: 6.25, max: 12.5, freq: 'BID', perCat: true }
        },
        'Spironolactone': { 
          category: 'Cardiology/Diuretic',
          dog: { dose: 2, max: 4, freq: 'SID' },
          cat: { dose: 1, max: 2, freq: 'SID' }
        },
        'Torsemide': { 
          category: 'Cardiology/Diuretic',
          dog: { dose: 0.1, max: 0.3, freq: 'SID' },
          cat: { dose: 0.1, max: 0.2, freq: 'SID' }
        },
        
        // NSAIDs
        'Carprofen': { 
          category: 'NSAID',
          dog: { dose: 2.2, max: 4.4, freq: 'SID' },
          cat: { dose: 4, max: 4, freq: 'Once (surgery only)' }
        },
        'Meloxicam': { 
          category: 'NSAID',
          dog: { dose: 0.1, max: 0.2, freq: 'SID' },
          cat: { dose: 0.05, max: 0.1, freq: 'SID (short term)' }
        },
        
        // Steroids
        'Prednisone': { 
          category: 'Steroid',
          dog: { dose: 0.5, max: 2, freq: 'SID-BID' },
          cat: { dose: 0.5, max: 1, freq: 'SID-BID' }
        },
        'Prednisolone': { 
          category: 'Steroid',
          dog: { dose: 0.5, max: 2, freq: 'SID-BID' },
          cat: { dose: 0.5, max: 1, freq: 'SID-BID' }
        },
        'Dexamethasone SP': { 
          category: 'Steroid',
          dog: { dose: 0.1, max: 0.2, freq: 'SID' },
          cat: { dose: 0.1, max: 0.2, freq: 'SID' }
        },
        
        // GI
        'Famotidine': { 
          category: 'GI/Antacid',
          dog: { dose: 0.5, max: 1, freq: 'BID' },
          cat: { dose: 0.5, max: 1, freq: 'BID' }
        },
        'Omeprazole': { 
          category: 'GI/PPI',
          dog: { dose: 0.7, max: 1, freq: 'SID' },
          cat: { dose: 0.5, max: 1, freq: 'SID' }
        },
        'Metoclopramide': { 
          category: 'GI/Prokinetic',
          dog: { dose: 0.2, max: 0.5, freq: 'BID-TID' },
          cat: { dose: 0.1, max: 0.5, freq: 'BID' }
        },
        'Maropitant': { 
          category: 'Antiemetic',
          dog: { dose: 1, max: 2, freq: 'SID' },
          cat: { dose: 1, max: 1, freq: 'SID' }
        },
        'Ondansetron': { 
          category: 'Antiemetic',
          dog: { dose: 0.5, max: 1, freq: 'BID-TID' },
          cat: { dose: 0.5, max: 1, freq: 'BID' }
        },
        
        // Antibiotics
        'Amoxicillin': { 
          category: 'Antibiotic',
          dog: { dose: 10, max: 20, freq: 'BID-TID' },
          cat: { dose: 10, max: 20, freq: 'BID-TID' }
        },
        'Amoxicillin-Clavulanate': { 
          category: 'Antibiotic',
          dog: { dose: 12.5, max: 25, freq: 'BID' },
          cat: { dose: 12.5, max: 25, freq: 'BID' }
        },
        'Enrofloxacin': { 
          category: 'Antibiotic/Fluoroquinolone',
          dog: { dose: 5, max: 10, freq: 'SID' },
          cat: { dose: 5, max: 5, freq: 'SID' }
        },
        'Cefpodoxime': { 
          category: 'Antibiotic/Cephalosporin',
          dog: { dose: 5, max: 10, freq: 'SID' },
          cat: { dose: 5, max: 10, freq: 'SID' }
        },
        'Clindamycin': { 
          category: 'Antibiotic/Lincosamide',
          dog: { dose: 5, max: 11, freq: 'BID' },
          cat: { dose: 5, max: 11, freq: 'BID' }
        },
        'Metronidazole': { 
          category: 'Antibiotic/Antiprotozoal',
          dog: { dose: 10, max: 15, freq: 'BID' },
          cat: { dose: 10, max: 15, freq: 'BID' }
        },
        
        // Analgesics
        'Tramadol': { 
          category: 'Analgesic',
          dog: { dose: 2, max: 5, freq: 'BID-QID' },
          cat: { dose: 2, max: 4, freq: 'BID' }
        },
        'Gabapentin': { 
          category: 'Analgesic/Anticonvulsant',
          dog: { dose: 5, max: 10, freq: 'BID-TID' },
          cat: { dose: 5, max: 10, freq: 'BID-TID' }
        },
        'Butorphanol': { 
          category: 'Opioid Agonist-Antagonist',
          dog: { dose: 0.2, max: 0.4, freq: 'BID-QID' },
          cat: { dose: 0.2, max: 0.4, freq: 'BID-QID' }
        },
        'Buprenorphine': { 
          category: 'Opioid Partial Agonist',
          dog: { dose: 0.02, max: 0.03, freq: 'BID-QID' },
          cat: { dose: 0.02, max: 0.03, freq: 'BID-QID' }
        },
        
        // Other
        'Diphenhydramine': { 
          category: 'Antihistamine',
          dog: { dose: 1, max: 2, freq: 'BID-TID' },
          cat: { dose: 1, max: 2, freq: 'BID' }
        },
        'Cerenia': { 
          category: 'Antiemetic',
          dog: { dose: 1, max: 1, freq: 'SID' },
          cat: { dose: 1, max: 1, freq: 'SID' }
        }
      };
      
      let currentUnit = 'kg';
      let currentDrug = null;
      
      // Initialize drug list
      function initDrugList() {
        const list = document.getElementById('drug-list');
        const categories = {};
        
        Object.entries(DRUGS).forEach(([name, data]) => {
          if (!categories[data.category]) categories[data.category] = [];
          categories[data.category].push(name);
        });
        
        Object.entries(categories).forEach(([category, drugs]) => {
          const catDiv = document.createElement('div');
          catDiv.style.cssText = 'padding: 0.5rem; background: #0f172a; color: #94a3b8; font-size: 0.75rem; font-weight: 600;';
          catDiv.textContent = category;
          list.appendChild(catDiv);
          
          drugs.forEach(name => {
            const div = document.createElement('div');
            div.className = 'drug-option';
            div.textContent = name;
            div.onclick = () => selectDrug(name);
            list.appendChild(div);
          });
        });
      }
      
      function showDrugList() {
        document.getElementById('drug-list').classList.add('show');
      }
      
      function hideDrugList() {
        setTimeout(() => {
          document.getElementById('drug-list').classList.remove('show');
        }, 200);
      }
      
      function filterDrugs() {
        const search = document.getElementById('drug-search').value.toLowerCase();
        const options = document.querySelectorAll('.drug-option');
        
        options.forEach(opt => {
          opt.style.display = opt.textContent.toLowerCase().includes(search) ? 'block' : 'none';
        });
        
        document.getElementById('drug-list').classList.add('show');
      }
      
      function selectDrug(name) {
        document.getElementById('drug-search').value = name;
        document.getElementById('drug-selected').value = name;
        document.getElementById('drug-list').classList.remove('show');
        currentDrug = DRUGS[name];
        updateDrugInfo();
        calculate();
      }
      
      function updateDrugInfo() {
        if (!currentDrug) return;
        
        const species = document.getElementById('species').value;
        const data = currentDrug[species];
        
        document.getElementById('drug-info').style.display = 'block';
        document.getElementById('info-name').textContent = document.getElementById('drug-search').value;
        document.getElementById('info-category').textContent = currentDrug.category;
        document.getElementById('info-species-dose').textContent = species === 'dog' ? 'üêï Dog dosing' : 'üêà Cat dosing';
        
        if (data.perCat) {
          document.getElementById('info-dose').textContent = `${data.dose}-${data.max} mg/cat`;
        } else {
          document.getElementById('info-dose').textContent = `${data.dose}-${data.max} mg/kg`;
        }
        document.getElementById('info-freq').textContent = data.freq;
        document.getElementById('info-max').textContent = data.perCat ? `${data.max} mg/cat` : `${data.max} mg/kg`;
      }
      
      function setUnit(unit) {
        currentUnit = unit;
        document.querySelectorAll('.unit-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Update chips
        const chips = document.getElementById('weight-chips');
        chips.innerHTML = '';
        const presets = unit === 'kg' ? [2.5, 5, 10, 20, 30] :
                       unit === 'lb' ? [5.5, 11, 22, 44, 66] :
                       [100, 250, 500, 1000];
        presets.forEach(w => {
          const btn = document.createElement('button');
          btn.className = 'chip' + (w === 10 && unit === 'kg' ? ' active' : '');
          btn.textContent = w;
          btn.onclick = () => setWeight(w);
          chips.appendChild(btn);
        });
        
        calculate();
      }
      
      function setWeight(w) {
        document.getElementById('weight').value = w;
        document.querySelectorAll('#weight-chips .chip').forEach(c => c.classList.remove('active'));
        event.target.classList.add('active');
        calculate();
      }
      
      function toKg(value, unit) {
        const num = parseFloat(value) || 0;
        if (unit === 'lb') return num * 0.453592;
        if (unit === 'g') return num / 1000;
        return num;
      }
      
      function calculate() {
        const species = document.getElementById('species').value;
        const weightInput = document.getElementById('weight').value;
        const drugName = document.getElementById('drug-selected').value;
        const conc = parseFloat(document.getElementById('concentration').value);
        const tabletSize = parseFloat(document.getElementById('tablet-size').value);
        
        const weightKg = toKg(weightInput, currentUnit);
        currentDrug = DRUGS[drugName];
        
        if (!weightKg || !currentDrug || !conc) {
          document.getElementById('result-mg').textContent = '--';
          document.getElementById('result-ml').textContent = '--';
          document.getElementById('result-freq').textContent = '--';
          document.getElementById('alert-danger').classList.remove('show');
          document.getElementById('alert-warning').classList.remove('show');
          return;
        }
        
        const data = currentDrug[species];
        let doseMg;
        
        if (data.perCat) {
          // Fixed dose per cat
          doseMg = data.dose;
        } else {
          // Weight-based dose
          doseMg = weightKg * data.dose;
        }
        
        const volumeMl = doseMg / conc;
        const maxDose = data.perCat ? data.max : weightKg * data.max;
        
        // Check alerts
        document.getElementById('alert-danger').classList.toggle('show', doseMg > maxDose);
        document.getElementById('alert-warning').classList.toggle('show', doseMg > maxDose * 0.8 && doseMg <= maxDose);
        
        // Update results
        document.getElementById('result-mg').textContent = doseMg.toFixed(data.perCat ? 1 : 1);
        document.getElementById('result-ml').textContent = volumeMl.toFixed(2);
        document.getElementById('result-freq').textContent = data.freq;
        
        // Show tablet info if tablet size entered
        if (tabletSize && tabletSize > 0) {
          const tablets = doseMg / tabletSize;
          document.getElementById('tablet-info').classList.add('show');
          document.getElementById('tablet-count').textContent = tablets.toFixed(2);
          document.getElementById('tablet-mg').textContent = tabletSize;
        } else {
          document.getElementById('tablet-info').classList.remove('show');
        }
        
        // Update drug info
        updateDrugInfo();
      }
      
      function toggleExtra(id) {
        const content = document.getElementById('extra-' + id);
        const btn = event.target;
        
        document.querySelectorAll('.extras-content').forEach(el => {
          if (el !== content) el.classList.remove('show');
        });
        document.querySelectorAll('.extras-btn').forEach(el => {
          if (el !== btn) el.classList.remove('active');
        });
        
        content.classList.toggle('show');
        btn.classList.toggle('active');
      }
      
      // Close drug list when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-wrapper')) {
          document.getElementById('drug-list').classList.remove('show');
        }
      });
      
      // Species change updates drug info
      document.getElementById('species').addEventListener('change', () => {
        if (currentDrug) updateDrugInfo();
      });
      
      // Initialize
      initDrugList();
      calculate();
    </script>
  </body>
</html>
