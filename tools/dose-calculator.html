<!doctype html>
<html lang="en" data-mode="pro" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dose Calculator | DVMReady</title>
    <meta name="description" content="Fast veterinary dose calculator. Calculate drug doses instantly for dogs and cats." />
    <link rel="icon" type="image/png" href="/assets/img/dvmready-logo.png" />
    <link rel="stylesheet" href="/assets/css/tokens.css" />
    <link rel="stylesheet" href="/assets/css/portal.css" />
    <style>
      /* Minimal, fast styles */
      * { box-sizing: border-box; }
      body { 
        font-family: system-ui, -apple-system, sans-serif;
        background: var(--pc-bg, #0f172a);
        color: var(--pc-text, #f8fafc);
        margin: 0;
        line-height: 1.5;
      }
      
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 1rem;
      }
      
      h1 {
        font-size: 1.5rem;
        margin: 0 0 0.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      /* Main Result - What doctors want FIRST */
      .main-result {
        background: linear-gradient(135deg, #0c607d 0%, #14a3c7 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        text-align: center;
      }
      
      .main-result__label {
        font-size: 0.875rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
      }
      
      .main-result__value {
        font-size: 3rem;
        font-weight: 700;
        line-height: 1;
      }
      
      .main-result__unit {
        font-size: 1.25rem;
        opacity: 0.8;
      }
      
      .main-result__secondary {
        margin-top: 0.75rem;
        font-size: 1rem;
        opacity: 0.9;
      }
      
      /* Input Panel */
      .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }
      
      .field {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .field label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--pc-text-muted, #94a3b8);
      }
      
      .field input, .field select {
        padding: 0.625rem 0.75rem;
        border: 1px solid var(--pc-border, #334155);
        border-radius: 8px;
        background: var(--pc-surface, #1e293b);
        color: inherit;
        font-size: 1rem;
      }
      
      .field input:focus, .field select:focus {
        outline: 2px solid #0c607d;
        border-color: #0c607d;
      }
      
      /* Unit toggle */
      .unit-toggle {
        display: flex;
        gap: 0.25rem;
        margin-top: 0.25rem;
      }
      
      .unit-btn {
        flex: 1;
        padding: 0.375rem;
        font-size: 0.75rem;
        border: 1px solid var(--pc-border, #334155);
        background: var(--pc-surface, #1e293b);
        color: var(--pc-text-muted, #94a3b8);
        border-radius: 6px;
        cursor: pointer;
      }
      
      .unit-btn.active {
        background: #0c607d;
        color: white;
        border-color: #0c607d;
      }
      
      /* Weight chips */
      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.375rem;
        margin-top: 0.375rem;
      }
      
      .chip {
        padding: 0.375rem 0.625rem;
        font-size: 0.75rem;
        border: 1px solid var(--pc-border, #334155);
        background: var(--pc-surface, #1e293b);
        color: var(--pc-text-muted, #94a3b8);
        border-radius: 6px;
        cursor: pointer;
      }
      
      .chip:hover, .chip.active {
        background: #0c607d;
        color: white;
        border-color: #0c607d;
      }
      
      /* Collapsible sections */
      .section {
        margin: 1rem 0;
        border: 1px solid var(--pc-border, #334155);
        border-radius: 8px;
        overflow: hidden;
      }
      
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background: var(--pc-surface, #1e293b);
        cursor: pointer;
        font-weight: 500;
      }
      
      .section-header:hover {
        background: rgba(255,255,255,0.05);
      }
      
      .section-content {
        padding: 1rem;
        display: none;
      }
      
      .section-content.open {
        display: block;
      }
      
      .toggle-icon {
        transition: transform 0.2s;
      }
      
      .section-header.open .toggle-icon {
        transform: rotate(180deg);
      }
      
      /* Warning box */
      .warning {
        background: rgba(245, 158, 11, 0.1);
        border: 1px solid rgba(245, 158, 11, 0.3);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        margin: 1rem 0;
        font-size: 0.875rem;
      }
      
      .warning strong {
        color: #d97706;
      }
      
      /* Safety alert */
      .alert {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        margin: 1rem 0;
        display: none;
      }
      
      .alert.show {
        display: block;
      }
      
      /* Navigation */
      .nav {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      
      .nav a {
        color: var(--pc-text-muted, #94a3b8);
        text-decoration: none;
        font-size: 0.875rem;
      }
      
      .nav a:hover {
        color: var(--pc-text, #f8fafc);
      }
      
      /* Loading state */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Navigation -->
      <nav class="nav">
        <a href="/">‚Üê Home</a>
        <a href="/tools/">Tools</a>
      </nav>
      
      <!-- Header -->
      <h1>üíä Dose Calculator</h1>
      <p style="color: var(--pc-text-muted, #94a3b8); margin: 0 0 1rem 0;">Fast drug dosing for dogs and cats</p>
      
      <!-- MAIN RESULT - What doctors want FIRST -->
      <div class="main-result">
        <div class="main-result__label">Total Dose Required</div>
        <div class="main-result__value">
          <span id="result-mg">--</span>
          <span class="main-result__unit">mg</span>
        </div>
        <div class="main-result__secondary">
          = <span id="result-ml">--</span> mL
        </div>
      </div>
      
      <!-- Quick Inputs -->
      <div class="input-grid">
        <!-- Species -->
        <div class="field">
          <label>Species</label>
          <select id="species" onchange="calculate()">
            <option value="dog">üêï Dog</option>
            <option value="cat">üêà Cat</option>
          </select>
        </div>
        
        <!-- Weight -->
        <div class="field">
          <label>Weight</label>
          <input id="weight" type="number" value="10" step="0.1" min="0.1" oninput="calculate()" />
          <div class="unit-toggle">
            <button type="button" class="unit-btn active" onclick="setUnit('kg')">kg</button>
            <button type="button" class="unit-btn" onclick="setUnit('lb')">lb</button>
            <button type="button" class="unit-btn" onclick="setUnit('g')">g</button>
          </div>
          <div class="chips" id="weight-chips">
            <button type="button" class="chip" onclick="setWeight(2.5)">2.5</button>
            <button type="button" class="chip" onclick="setWeight(5)">5</button>
            <button type="button" class="chip active" onclick="setWeight(10)">10</button>
            <button type="button" class="chip" onclick="setWeight(20)">20</button>
            <button type="button" class="chip" onclick="setWeight(30)">30</button>
          </div>
        </div>
        
        <!-- Drug -->
        <div class="field">
          <label>Drug</label>
          <select id="drug" onchange="onDrugChange()">
            <option value="">Select drug...</option>
          </select>
        </div>
        
        <!-- Concentration -->
        <div class="field">
          <label>Concentration (mg/mL)</label>
          <input id="concentration" type="number" placeholder="e.g. 50" oninput="calculate()" />
        </div>
      </div>
      
      <!-- Safety Alert -->
      <div class="alert" id="safety-alert">
        <strong>‚ö†Ô∏è Max Dose Exceeded</strong><br>
        Calculated dose exceeds recommended maximum. Please verify.
      </div>
      
      <!-- Warning -->
      <div class="warning">
        <strong>‚ö†Ô∏è Clinical Verification Required</strong><br>
        Always verify doses against current formularies before administering.
      </div>
      
      <!-- Optional Details (Collapsed) -->
      <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
          <span>üìã Drug Details & Reference</span>
          <span class="toggle-icon">‚ñº</span>
        </div>
        <div class="section-content">
          <p id="drug-info">Select a drug to see dosing information.</p>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
          <span>üìñ How to Use</span>
          <span class="toggle-icon">‚ñº</span>
        </div>
        <div class="section-content">
          <ol>
            <li>Select species (Dog or Cat)</li>
            <li>Enter patient weight (kg, lb, or g)</li>
            <li>Choose drug from dropdown</li>
            <li>Enter concentration from vial label</li>
            <li>Read total dose in mg and volume in mL</li>
          </ol>
          <p><strong>Formula:</strong> Dose (mg) = Weight (kg) √ó Dose rate (mg/kg)</p>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
          <span>üñ®Ô∏è Print / Save</span>
          <span class="toggle-icon">‚ñº</span>
        </div>
        <div class="section-content">
          <button onclick="window.print()" style="padding: 0.5rem 1rem; background: #0c607d; color: white; border: none; border-radius: 6px; cursor: pointer;">
            Print Calculation
          </button>
        </div>
      </div>
    </div>
    
    <script>
      // Minimal drug database - essential drugs only
      const DRUGS = {
        'Amoxicillin': { dose: 10, max: 20, freq: 'BID-TID' },
        'Carprofen': { dose: 2.2, max: 4.4, freq: 'SID' },
        'Meloxicam': { dose: 0.1, max: 0.2, freq: 'SID' },
        'Furosemide': { dose: 2, max: 4, freq: 'SID-BID' },
        'Pimobendan': { dose: 0.25, max: 0.3, freq: 'BID' },
        'Benazepril': { dose: 0.25, max: 0.5, freq: 'SID' },
        'Enalapril': { dose: 0.5, max: 1, freq: 'SID' },
        'Amlodipine': { dose: 0.15, max: 0.25, freq: 'SID' },
        'Atenolol': { dose: 0.5, max: 1, freq: 'BID' },
        'Prednisone': { dose: 0.5, max: 2, freq: 'SID' },
        'Prednisolone': { dose: 0.5, max: 2, freq: 'SID' },
        'Dexamethasone': { dose: 0.1, max: 0.2, freq: 'SID' },
        'Diphenhydramine': { dose: 1, max: 2, freq: 'BID-TID' },
        'Famotidine': { dose: 0.5, max: 1, freq: 'BID' },
        'Omeprazole': { dose: 0.7, max: 1, freq: 'SID' },
        'Metoclopramide': { dose: 0.2, max: 0.5, freq: 'BID-TID' },
        'Maropitant': { dose: 1, max: 2, freq: 'SID' },
        'Ondansetron': { dose: 0.5, max: 1, freq: 'BID' },
        'Butorphanol': { dose: 0.2, max: 0.4, freq: 'BID-QID' },
        'Buprenorphine': { dose: 0.02, max: 0.03, freq: 'BID-QID' },
        'Spironolactone': { dose: 2, max: 4, freq: 'SID' },
        'Torsemide': { dose: 0.1, max: 0.3, freq: 'SID' }
      };
      
      // Populate drug dropdown
      const drugSelect = document.getElementById('drug');
      Object.keys(DRUGS).sort().forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        drugSelect.appendChild(option);
      });
      
      let currentUnit = 'kg';
      
      function setUnit(unit) {
        currentUnit = unit;
        document.querySelectorAll('.unit-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Update weight chips
        const chips = document.getElementById('weight-chips');
        chips.innerHTML = '';
        const presets = unit === 'kg' ? [2.5, 5, 10, 20, 30] :
                       unit === 'lb' ? [5.5, 11, 22, 44, 66] :
                       [100, 250, 500, 1000];
        presets.forEach(w => {
          const btn = document.createElement('button');
          btn.className = 'chip' + (w === 10 && unit === 'kg' ? ' active' : '');
          btn.textContent = w;
          btn.onclick = () => setWeight(w);
          chips.appendChild(btn);
        });
        
        calculate();
      }
      
      function setWeight(w) {
        document.getElementById('weight').value = w;
        document.querySelectorAll('#weight-chips .chip').forEach(c => c.classList.remove('active'));
        event.target.classList.add('active');
        calculate();
      }
      
      function toKg(value, unit) {
        const num = parseFloat(value) || 0;
        if (unit === 'lb') return num * 0.453592;
        if (unit === 'g') return num / 1000;
        return num;
      }
      
      function onDrugChange() {
        const drug = DRUGS[document.getElementById('drug').value];
        if (drug) {
          document.getElementById('drug-info').innerHTML = `
            <strong>Dose:</strong> ${drug.dose}-${drug.max} mg/kg ${drug.freq}<br>
            <strong>Reference:</strong> Plumb's Veterinary Drug Handbook
          `;
        }
        calculate();
      }
      
      function calculate() {
        const species = document.getElementById('species').value;
        const weightInput = document.getElementById('weight').value;
        const drugName = document.getElementById('drug').value;
        const conc = parseFloat(document.getElementById('concentration').value);
        
        const weightKg = toKg(weightInput, currentUnit);
        const drug = DRUGS[drugName];
        
        if (!weightKg || !drug || !conc) {
          document.getElementById('result-mg').textContent = '--';
          document.getElementById('result-ml').textContent = '--';
          document.getElementById('safety-alert').classList.remove('show');
          return;
        }
        
        const doseMg = weightKg * drug.dose;
        const volumeMl = doseMg / conc;
        
        // Check max dose
        const maxDose = weightKg * drug.max;
        const alert = document.getElementById('safety-alert');
        
        if (doseMg > maxDose) {
          alert.classList.add('show');
        } else {
          alert.classList.remove('show');
        }
        
        // Update results
        document.getElementById('result-mg').textContent = doseMg.toFixed(1);
        document.getElementById('result-ml').textContent = volumeMl.toFixed(2);
      }
      
      function toggleSection(header) {
        header.classList.toggle('open');
        header.nextElementSibling.classList.toggle('open');
      }
      
      // Initial calculation
      calculate();
    </script>
  </body>
</html>
